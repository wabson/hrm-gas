<!DOCTYPE html>
<html>
    <head>
        <base target="_top">
        <?!= include('dialogs.head.include'); ?>
    </head>
    <body>
        <div class="block form-group">
            <label for="input-race-name">Race name</label>
            <input type="text" id="input-race-name" style="width: 250px;">
        </div>
        <div class="block">
            <div class="inline form-group">
                <label for="select-race-type">Race type</label>
                <select id="select-race-type" disabled>
                    <option value="" selected>Select</option>
                </select>
            </div>
            <div class="inline form-group">
                <label for="select-race-region">Region</label>
                <select id="select-race-region" disabled>
                    <option value="" selected>Select</option>
                    <option value="EA">Eastern</option>
                    <option value="LS">London & South East</option>
                    <option value="MID">Midlands</option>
                    <option value="NO">Northern</option>
                    <option value="NW">North West</option>
                    <option value="SCOE">Scotland East</option>
                    <option value="SCOW">Scotland West</option>
                    <option value="SO">Southern</option>
                    <option value="SW">South West</option>
                    <option value="WA">Wales</option>
                    <option value="YH">Yorkshire</option>
                    <option value="CS">Services</option>
                </select>
            </div>
        </div>
        <div class="block form-group">
            <input type="checkbox" id="checkbox-rankings" checked>
            <label for="checkbox-rankings">Import rankings automatically</label>
        </div>
        <div class="block form-group">
            <input id="btn-start" type="button" value="Start" class="action" disabled />
            <input id="btn-cancel" type="button" value="Close" />
        </div>

        <script>
            function onRaceTemplatesLoaded(data) {
                var selectEl = $('#select-race-type'), sheets = data, sheet, html = '';
                for (var i = 0; i<sheets.length; i++) {
                    sheet = sheets[i];
                    html += '<option value="'+sheet.id+'">' + sheet.name + '</option>';
                }
                selectEl.append(html).prop('disabled', false);
                $('#btn-start').prop('disabled', false);
            }
            function onRaceTemplateSelected(e) {
                var regionSelectEl = $('#select-race-region'),
                        raceTypeSelectEl = $('#select-race-type option:selected'),
                        raceTypeName = raceTypeSelectEl.text(),
                        regionInUse = raceTypeName == 'Hasler Race';
                regionSelectEl.prop('disabled', !regionInUse);
            }

            $(function() {

                $('#btn-start').click(function(event) {
                    event.preventDefault();
                    google.script.run.withSuccessHandler(function() {
                        google.script.host.close();
                    }).dialog_start_submit();
                });

                $('#btn-cancel').click(function(event) {
                    event.preventDefault();
                    google.script.host.close();
                });

                $('#select-race-type').change(function(event) {
                    event.preventDefault();
                    onRaceTemplateSelected(event);
                });

                google.script.run.withSuccessHandler(onRaceTemplatesLoaded).dialog_start_getRaceTemplates();
            });
        </script>
        <!--=include ../mock-services.html -->

    </body>
</html>